<script type="text/javascript">

	function modifyBudget (verb) {
			var budget_with_currency = document.getElementById("budget").value;
			var budget_save = budget_with_currency
			var budget = Number(budget_with_currency.replace(/[^0-9\.]+/g,""));
		
		$(function () {
			$("#budget_slider").slider({
				value: budget,
				min: 0,
				max: 150,
				slide: function(event, ui) {
					$("#budget").val('$' + ui.value +'.00');
				}
				
			});
			$("#budget").val('$' + $("#budget_slider").slider("value") + '.00');

		});

		$(function () {
			$("#budget_slider").slider({
				change: function(event, ui) {
					drawChart();
			}
				
			});
		});

		if (verb == "post") {
			$('#allowance_form').submit();
		}

	}	

	
	
	function modifyBalance (verb) {
		
		$(function () {
			var budget_with_currency = document.getElementById("budget").value;
			var budget = Number(budget_with_currency.replace(/[^0-9\.]+/g,""));
			var balance_with_currency = document.getElementById("balance").value;
			var balance = Number(balance_with_currency.replace(/[^0-9\.]+/g,""));
			$("#balance_slider").slider({
				value: balance,
				min: 0,
				max: 150,
				slide: function(event, ui) {
					$("#balance").val('$' + ui.value +'.00');
				}
			});
			$("#balance").val('$' + $("#balance_slider").slider("value")+'.00');
		});


		$(function () {
			$("#balance_slider").slider({
				change: function(event, ui) {
					drawChart();
				}	
				
			});
		});

		if (verb == "post") {
			$('#allowance_form').submit();
		}


	}	

	function drawChart(){

		var budget_with_currency = document.getElementById("budget").value;
		var budget = Number(budget_with_currency.replace(/[^0-9\.]+/g, ""));
		var balance_with_currency = document.getElementById("balance").value;
		var balance = Number(balance_with_currency.replace(/[^0-9\.]+/g, ""));
		if (balance > budget) {
			balance = budget;
			document.getElementById("balance").value = '$' + budget + '.00';
			modifyBalance ();
		}
		var balance_position = (balance / budget) * 100;
		var tick = ((budget / 40).toFixed(1)) * 10;
		var background = "chf=c,lg,90,FFE7C6,0,76A4FB,0.5"
		var uri = "http://chart.apis.google.com/chart?cht=gom&chs=280x100&chf=bg,lg,90,F4F5F7,0.75,E3E4EA,0&chxt=y&chd=t:" + balance_position + "&chl=Balance&chxr=0,0," + budget + "," + tick;
		document.getElementById("chartdiv").src = uri;

	}

	
	function convertToCurrency(){
		document.getElementById("budget").value = '$' + document.getElementById("budget").value;
		document.getElementById("balance").value = '$' + document.getElementById("balance").value;
	}
		
	function modifyUnderOver(verb) {
		
		$(function () {
		
			under = document.getElementById("under").value;
			over = document.getElementById("over").value;
			if (under.charAt(0) == '$') {under = under.slice(1)}
			if (over.charAt(0) == '$') {over = over.slice(1)}
	
			$("#slider-range").slider({
				range: true,
				min: 0,
				max: 100,
				values: [under, over],
				slide: function(event, ui) {
					$("#under").val('$' + ui.values[0] + '.00');
					$("#over").val('$' + ui.values[1] + '.00');
				}
			});
	
			$("#under").val('$' + $("#slider-range").slider("values", 0) + '.00');
			$("#over").val('$' + $("#slider-range").slider("values", 1) + '.00');
			});

		if (verb == "post") {
			$('#amounts_form').submit();
		}

	}



	function viewConsumers(new_id){
		$.ajax({
			url: 'consumers/'+new_id})};


	function viewAllowance(consumer){
		$.ajax({
			url: 'allowance/'+consumer,
			success: function(data){
				drawChart();
				modifyBudget('get');
				modifyBalance('get');			
				$(function() {$("#radio").buttonset();
				});
		}
	})
	};

	function viewApprovals(consumer){
		$.ajax({
			url: 'approvals/'+consumer,
			success: function(data){
				modifyUnderOver('get');
			}
		})
	};



	function consumer_info(id) {

		var selector = "div[id = " + id.toString() + " ]"
			
		$('.portlet-header').removeClass('ui-widget-header-lightness');
		$(selector).addClass('ui-widget-header-lightness');
		viewAllowance(id);
		viewApprovals(id);
	}


/*	Populate tabs by calling ajax  */

		viewConsumers (0);	

</script>


<div id="tabs">
	<ul>
		<li><a href="#consumers">Consumers</a></li>
		<li><a href="#allowance">Allowance</a></li>
		<li><a href="#approvals">Approvals</a></li>
		<li><a href="#content">Content</a></li>
		<li><a href="#inbox">Inbox</a></li>
		<li><a href="#purchases">Purchases!</a></li>
		<li><a href="#account">Account</a></li>
				<li><a href="#alerts">Alerts!</a></li>

	</ul>


	<div id="consumers">
		<div class="left_content">
			<p class="inner_content_title">Who would you like to take care for?</p>
			<div class="inner_content_indented">
				<p class="inner_content_text">Define here who gets a one-click shopping experience (provided your rules are met).</p>
				<p class="inner_content_text">To add a consumer, key-in his or her phone number and wait for the text message.</p>
				<br />
				<% form_for(:consumer, :url => {:action => "sms_consumer"}, :html => {:id => "phone_form"}) do |f| %>
					<%= f.text_field :billing_phone, :size => 20, :placeholder => "Phone number", :class => "formfield" %>
					<%= submit_tag "Click when done",:class => "fg-button ui-state-default loginbutton ui-corner-all"  %>
				<% end %>
				<br />
				<p class="inner_content_text">Once you got the text message, key-in the PIN code here:</p>  
				<% form_for(:consumer, :url => {:action => "check_pin_and_link_consumer"}, :html => {:id => "pin_form"}) do |f| %>
					<%= f.text_field :pin, :size => 20, :placeholder => "Received PIN", :class => "formfield"  %>
					<%= submit_tag "Click when done", :class => "fg-button ui-state-default loginbutton ui-corner-all"  %>
				<% end %>
			</div>
		</div>
		<div class="right_content consumers_list">
		</div>
	</div>


	<div id="allowance">
		<div class="left_content" id="allowance_consumer">
			<p class="inner_content_title" id="consumer_name_allowance"></p>		
			<img id='chartdiv' class="engrave"/>
			<br /><br /><br />
			<% form_for :payer_rule, :url => { :action => :consumer_rules_update }, :html => {:id => "allowance_form"} do |f| %>			
			    <span class="long item">Monthly Allowance:</span>
				<span class="value"><%= f.text_field(:edited_budget, :onchange => "modifyBudget('post')", :id => "budget", :size => 10) %></span>
			    <div class="long item" id="budget_slider" onclick="modifyBudget('post')"></div>
				<br />
			    <span class="long item">Current Balance:</span>
				<span class="green_value"><%= text_field(:consumer, :edited_balance, :onchange => "modifyBalance('post')", :id => "balance", :class => "dollar_amount", :size => 10) %></span>
			    <div id="balance_slider" onclick="modifyBalance('post')"></div>
				<br />
				<span class="item">Balance rollover</span>
				<span id="radio">
					<%= f.radio_button("rollover_human", "On", :onchange => "$('#allowance_form').submit();") %><label for="payer_rule_rollover_human_on">On</label>
					<%= f.radio_button("rollover_human", "Off",:onchange => "$('#allowance_form').submit();")%><label for="payer_rule_rollover_human_off">Off</label>
				</span>			
			<% end %>
			<%= image_tag "/images/face_placeholder.png", :id => "face" %>	
		</div>
			<div class="right_content">
			<% if @consumers.empty? %>				
				<%= image_tag "/images/thanks_for_joining5.png", :class => "righthandside_marketial" %>
			<% else %>
				<p class="inner_content_title" id="consumers">My Close Circle</p>
				<div class="column1 allowance">
				</div>
				<div class="column2 allowance">
				</div>
			<% end %>
			<%= image_tag 'circle.png', :id => "circle" %>
		</div>				
	</div>



<div id="approvals">
		<div class="left_content" id="allowance_consumer">
			<p class="inner_content_title" id="consumer_name_approvals"></p>		
			<p class="inner_content_text">Define here who gets a one-click shopping experience (provided your rules are met).</p>
			<p class="inner_content_text">To add a consumer, key-in his or her phone number and wait for the text message.</p>
			<% form_for :payer_rule, :url => { :action => :consumer_rules_update }, :html => {:id => "amounts_form"} do |f| %>			
			    <span class="long item">Approve under</span>
				<span class="value"><%= f.text_field(:edited_auto_authorize_under, :onchange => "modifyUnderOver('post')", :id => "under", :size => 10) %></span>
				<br />
			    <span class="long item">Unapprove over</span>
				<span class="green_value"><%= f.text_field(:edited_auto_deny_over, :onchange => "modifyUnderOver('post')", :id => "over",  :size => 10) %></span>
				<br />
			<% end %>
			<div id='slider-range' class="engrave" onclick="modifyUnderOver('post')"></div>
			<%= image_tag "/images/face_placeholder.png", :id => "face" %>	
		</div>
			<div class="right_content">
			<% if @consumers.empty? %>				
				<%= image_tag "/images/thanks_for_joining5.png", :class => "righthandside_marketial" %>
			<% else %>
				<p class="inner_content_title" id="consumers">My Close Circle</p>
				<div class="column1 allowance">
				</div>
				<div class="column2 allowance">
				</div>
			<% end %>
			<%= image_tag 'circle.png', :id => "circle" %>
		</div>	
</div>


	<div id="content">
		<p>Proin elit arcu, rutrum commodo, vehicula tempus, commodo a, risus. Curabitur nec arcu. Donec sollicitudin mi sit amet mauris. Nam elementum quam ullamcorper ante. Etiam aliquet massa et lorem. Mauris dapibus lacus auctor risus. Aenean tempor ullamcorper leo. Vivamus sed magna quis ligula eleifend adipiscing. Duis orci. Aliquam sodales tortor vitae ipsum. Aliquam nulla. Duis aliquam molestie erat. Ut et mauris vel pede varius sollicitudin. Sed ut dolor nec orci tincidunt interdum. Phasellus ipsum. Nunc tristique tempus lectus.</p>
	</div>

	<div id="inbox">

	</div>

	<div id="purchases">
		<p>Proin elit arcu, rutrum commodo, vehicula tempus, commodo a, risus. Curabitur nec arcu. Donec sollicitudin mi sit amet mauris. Nam elementum quam ullamcorper ante. Etiam aliquet massa et lorem. Mauris dapibus lacus auctor risus. Aenean tempor ullamcorper leo. Vivamus sed magna quis ligula eleifend adipiscing. Duis orci. Aliquam sodales tortor vitae ipsum. Aliquam nulla. Duis aliquam molestie erat. Ut et mauris vel pede varius sollicitudin. Sed ut dolor nec orci tincidunt interdum. Phasellus ipsum. Nunc tristique tempus lectus.</p>
	</div>
	<div id="account">
		<p>Proin elit arcu, rutrum commodo, vehicula tempus, commodo a, risus. Curabitur nec arcu. Donec sollicitudin mi sit amet mauris. Nam elementum quam ullamcorper ante. Etiam aliquet massa et lorem. Mauris dapibus lacus auctor risus. Aenean tempor ullamcorper leo. Vivamus sed magna quis ligula eleifend adipiscing. Duis orci. Aliquam sodales tortor vitae ipsum. Aliquam nulla. Duis aliquam molestie erat. Ut et mauris vel pede varius sollicitudin. Sed ut dolor nec orci tincidunt interdum. Phasellus ipsum. Nunc tristique tempus lectus.</p>
	</div>
	<div id="alerts">
		<p>Proin elit arcu, rutrum commodo, vehicula tempus, commodo a, risus. Curabitur nec arcu. Donec sollicitudin mi sit amet mauris. Nam elementum quam ullamcorper ante. Etiam aliquet massa et lorem. Mauris dapibus lacus auctor risus. Aenean tempor ullamcorper leo. Vivamus sed magna quis ligula eleifend adipiscing. Duis orci. Aliquam sodales tortor vitae ipsum. Aliquam nulla. Duis aliquam molestie erat. Ut et mauris vel pede varius sollicitudin. Sed ut dolor nec orci tincidunt interdum. Phasellus ipsum. Nunc tristique tempus lectus.</p>
	</div>
	
</div>

