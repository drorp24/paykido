<div id="tabs">
	<ul>
		<li><a href="#tabs-1">Consumers</a></li>
		<li><a href="#tabs-2">Allowance</a></li>
		<li><a href="#tabs-3">Inbox</a></li>
		<li><a href="#tabs-4">Content</a></li>
		<li><a href="#tabs-5">Rules</a></li>
		<li><a href="#tabs-6">Purchases!</a></li>
		<li><a href="#tabs-7">Account</a></li>
				<li><a href="#tabs-8">Alerts!</a></li>

	</ul>


	<div id="tabs-1">
		<div class="left_content">
			<p class="inner_content_title">Who would you like to take care for?</p>
			<div class="inner_content_indented">
				<p class="inner_content_text">Define here who gets a one-click shopping experience (provided your rules are met).</p>
				<p class="inner_content_text">To add a consumer, key-in his or her phone number and wait for the text message.</p>
				<br />
				<% form_for(:consumer, :url => {:action => "sms_consumer"}, :html => {:id => "phone_form"}) do |f| %>
					<%= f.text_field :billing_phone, :size => 20, :placeholder => "Phone number", :class => "formfield" %>
					<%= submit_tag "Click when done",:class => "fg-button ui-state-default loginbutton ui-corner-all"  %>
				<% end %>
				<br />
				<p class="inner_content_text">Once you got the text message, key-in the PIN code here:</p>  
				<% form_for(:consumer, :url => {:action => "check_pin_and_link_consumer"}, :html => {:id => "pin_form"}) do |f| %>
					<%= f.text_field :pin, :size => 20, :placeholder => "Received PIN", :class => "formfield"  %>
					<%= submit_tag "Click when done", :class => "fg-button ui-state-default loginbutton ui-corner-all"  %>
				<% end %>
			</div>
		</div>
		<div class="right_content">
	<% if @consumers.empty? %>				
		<%= image_tag "/images/thanks_for_joining5.png", :class => "righthandside_marketial" %>
	<% else %>
		<p class="inner_content_title" id="consumers">My Close Circle</p>
		<br />
		<div class="column" id="column1">
		</div>
		<div class="column" id="column2">
		</div>
	<% end %>
	<%= image_tag 'circle.png', :id => "circle" %>
	</div>
</div>

<script type="text/javascript">
	<% i = 1 %>
	<% for consumer in @consumers %>
		<% rem = i % 2 %>
		<% if rem == 1 %>
			$('#column1').append(
				'<div class="portlet ui-widget ui-widget-content ui-helper-clearfix ui-corner-all">'+
					'<div class="portlet-header ui-widget-header ui-corner-all"><%= escape_javascript((consumer.name.blank?)?'(Please define name)':consumer.name) %></div>'+
					'<div class="portlet-content" >'+
						'<div class="portlet-content-left">'+
							'<%= image_tag "face_placeholder_small.png" %>'+
						'</div>'+
						'<div class="portlet-content-right">'+
							'<p><%= "Spent #{number_to_currency(consumer.sum_amount)} in #{Time.now.strftime('%B')}" %></p>'+
							'<p><%= "Current Balance #{number_to_currency(consumer.balance)}" %></p>'+		
						'</div>'+
					'</div>'+
				'</div>');
		<% else %>
			$('#column2').append(
				'<div class="portlet ui-widget ui-widget-content ui-helper-clearfix ui-corner-all">'+
					'<div class="portlet-header ui-widget-header ui-corner-all"><%= escape_javascript((consumer.name.blank?)?'(Please define name)':consumer.name) %></div>'+
					'<div class="portlet-content" >'+
						'<div class="portlet-content-left">'+
							'<%= image_tag "face_placeholder_small.png" %>'+
						'</div>'+
						'<div class="portlet-content-right">'+
							'<p><%= "Spent #{number_to_currency(consumer.sum_amount)} in #{Time.now.strftime('%B')}" %></p>'+
							'<p><%= "Current Balance #{number_to_currency(consumer.balance)}" %></p>'+		
						'</div>'+
					'</div>'+
				'</div>');
		<% end %>
		<% i += 1 %>
	<% end %>

</script>

<div id="tabs-2">

	<div class="left_content" id="allowance_consumer">
	<p class="inner_content_title" id="consumer_name"></p>

	<img id='chartdiv' class="engrave"/>
	<br /><br /><br />
	<% form_for :consumer_rule, :url => { :action => :budget_update } do |f| %>
	  	<%= f.error_messages %>
	
	    <span class="long item">Monthly Allowance:</span>
		<span class="value"><%= f.text_field(:edited_budget, :onchange => "drawChart();modifyBudget()", :id => "budget", :size => 10) %></span>
	    <div class="long item" id="budget_slider" onclick="modifyBudget()"></div>
		<br />
	    <span class="long item">Current Balance:</span>
		<span class="green_value"><%= text_field(:consumer, :edited_balance, :onchange => "drawChart();modifyBalance()", :id => "balance", :class => "dollar_amount", :size => 10) %></span>
	    <div id="balance_slider" onclick="modifyBalance()"></div>
		<br />
		<span class="item">Balance rollover</span>
		<span id="radio">
			<%= f.radio_button (:rollover_human, 'On') %><label for="consumer_rule_rollover_human_on">On</label>
			<%= f.radio_button (:rollover_human, 'Off') %><label for="consumer_rule_rollover_human_off">Off</label>
		</span>

	
		<div>
		   <%= submit_tag "Submit", :class => "fg-button ui-state-default loginbutton ui-corner-all" %>	
		</div>
	
	<% end %>
	<%= image_tag "/images/face_placeholder.png", :id => "face" %>	
	</div>
	<div class="right_content">
	<% if @consumers.empty? %>				
		<%= image_tag "/images/thanks_for_joining5.png", :class => "righthandside_marketial" %>
	<% else %>
		<p class="inner_content_title" id="consumers">My Close Circle</p>
		<br />
		<div class="column" id="column21">
		</div>
		<div class="column" id="column22">
		</div>
	<% end %>
	<%= image_tag 'circle.png', :id => "circle" %>
	</div>				
</div>


<script type="text/javascript">
	

		<% if session[:consumers_counter] > 0 %>
			viewAllowance (<%= session[:consumer].id %>);
			viewConsumers2 ();	
		<% end %>
		

		function viewAllowance(consumer){
		$.ajax({
			url: 'allowance/'+consumer,
			success: function(data){
				drawChart();
				modifyBudget();
				modifyBalance();			
				$(function() {
					$("#radio").buttonset();
					});

			}
			})
		};
	

		function viewConsumers2 () {

/*
		<% i = 1 %>
		<% for consumer in @consumers %>
			<% rem = i % 2 %>
			<% if rem == 1 %>
				$('#column21').append('<div class="portlet ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"><div onclick = "viewAllowance(<%= consumer.id %>)" class="portlet-header ui-widget-header ui-corner-all"><%= escape_javascript(consumer.name) %></div><div class="portlet-content" >Lorem ipsum dolor sit amet, consectetuer adipiscing elit</div></div>');
			<% else %>
				$('#column22').append('<div class="portlet ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"><div onclick = "viewAllowance(<%= consumer.id %>)" class="portlet-header ui-widget-header ui-corner-all"><%= escape_javascript(consumer.name) %></div><div class="portlet-content" >Lorem ipsum dolor sit amet, consectetuer adipiscing elit</div></div>');
			<% end %>
			<% i += 1 %>
		<% end %>


*/		
		<% i = 1 %>
		<% for consumer in @consumers %>
			<% rem = i % 2 %>
			<% if rem == 1 %>
				$('#column21').append(
					'<div class="portlet ui-widget ui-widget-content ui-helper-clearfix ui-corner-all">'+
						'<div onclick = "viewAllowance(<%= consumer.id %>)" class="portlet-header ui-widget-header ui-corner-all"><%= escape_javascript((consumer.name.blank?)?'(Please define name)':consumer.name) %></div>'+
						'<div class="portlet-content" >'+
							'<div class="portlet-content-left">'+
								'<%= image_tag "face_placeholder_small.png" %>'+
							'</div>'+
							'<div class="portlet-content-right">'+
								'<p><%= "Spent #{number_to_currency(consumer.sum_amount)} in #{Time.now.strftime('%B')}" %></p>'+
								'<p><%= "Current Balance #{number_to_currency(consumer.balance)}" %></p>'+		
							'</div>'+
						'</div>'+
					'</div>');
			<% else %>
				$('#column22').append(
					'<div class="portlet ui-widget ui-widget-content ui-helper-clearfix ui-corner-all">'+
						'<div onclick = "viewAllowance(<%= consumer.id %>)" class="portlet-header ui-widget-header ui-corner-all"><%= escape_javascript((consumer.name.blank?)?'(Please define name)':consumer.name) %></div>'+
						'<div class="portlet-content" >'+
							'<div class="portlet-content-left">'+
								'<%= image_tag "face_placeholder_small.png" %>'+
							'</div>'+
							'<div class="portlet-content-right">'+
								'<p><%= "Spent #{number_to_currency(consumer.sum_amount)} in #{Time.now.strftime('%B')}" %></p>'+
								'<p><%= "Current Balance #{number_to_currency(consumer.balance)}" %></p>'+		
							'</div>'+
						'</div>'+
					'</div>');
			<% end %>
			<% i += 1 %>
		<% end %>
		
		}

		function modifyBudget () {
		
			$(function () {
			  	var budget_with_currency = document.getElementById("budget").value;
				var budget = Number(budget_with_currency.replace(/[^0-9\.]+/g,""));
				$("#budget_slider").slider({
					value: budget,
					min: 0,
					max: 150,
					slide: function(event, ui) {
						$("#budget").val('$' + ui.value +'.00');
					}
				});
				$("#budget").val('$' + $("#budget_slider").slider("value")+'.00');
				drawChart();

			});
		}	
	
		function modifyBalance () {
		
			$(function () {
			  	var budget_with_currency = document.getElementById("budget").value;
				var budget = Number(budget_with_currency.replace(/[^0-9\.]+/g,""));
			  	var balance_with_currency = document.getElementById("balance").value;
				var balance = Number(balance_with_currency.replace(/[^0-9\.]+/g,""));
				$("#balance_slider").slider({
					value: balance,
					min: 0,
					max: 150,
					slide: function(event, ui) {
						$("#balance").val('$' + ui.value +'.00');
					}
				});
				$("#balance").val('$' + $("#balance_slider").slider("value")+'.00');
				drawChart();
			});
		}	

	

		function drawChart(){

			var budget_with_currency = document.getElementById("budget").value;
			var budget = Number(budget_with_currency.replace(/[^0-9\.]+/g, ""));
			var balance_with_currency = document.getElementById("balance").value;
			var balance = Number(balance_with_currency.replace(/[^0-9\.]+/g, ""));
			if (balance > budget) {
				balance = budget;
				document.getElementById("balance").value = '$' + budget + '.00';
				modifyBalance ();
			}
			var balance_position = (balance / budget) * 100;
			var tick = ((budget / 40).toFixed(1)) * 10;
			var background = "chf=c,lg,90,FFE7C6,0,76A4FB,0.5"
			var uri = "http://chart.apis.google.com/chart?cht=gom&chs=280x100&chf=bg,lg,90,F4F5F7,0.75,E3E4EA,0&chxt=y&chd=t:" + balance_position + "&chl=Balance&chxr=0,0," + budget + "," + tick;
			document.getElementById("chartdiv").src = uri;

		}

	
		function convertToCurrency(){
			document.getElementById("budget").value = '$' + document.getElementById("budget").value;
			document.getElementById("balance").value = '$' + document.getElementById("balance").value;
		}

	

</script>


<div id="tabs-3">

		<p>Proin elit arcu, rutrum commodo, vehicula tempus, commodo a, risus. Curabitur nec arcu. Donec sollicitudin mi sit amet mauris. Nam elementum quam ullamcorper ante. Etiam aliquet massa et lorem. Mauris dapibus lacus auctor risus. Aenean tempor ullamcorper leo. Vivamus sed magna quis ligula eleifend adipiscing. Duis orci. Aliquam sodales tortor vitae ipsum. Aliquam nulla. Duis aliquam molestie erat. Ut et mauris vel pede varius sollicitudin. Sed ut dolor nec orci tincidunt interdum. Phasellus ipsum. Nunc tristique tempus lectus.</p>
	</div>
	<div id="tabs-4">
		<p>Proin elit arcu, rutrum commodo, vehicula tempus, commodo a, risus. Curabitur nec arcu. Donec sollicitudin mi sit amet mauris. Nam elementum quam ullamcorper ante. Etiam aliquet massa et lorem. Mauris dapibus lacus auctor risus. Aenean tempor ullamcorper leo. Vivamus sed magna quis ligula eleifend adipiscing. Duis orci. Aliquam sodales tortor vitae ipsum. Aliquam nulla. Duis aliquam molestie erat. Ut et mauris vel pede varius sollicitudin. Sed ut dolor nec orci tincidunt interdum. Phasellus ipsum. Nunc tristique tempus lectus.</p>
	</div>

	<div id="tabs-5">
<script type="text/javascript">
	$(function() {
		under = document.getElementById("under").value;
		over = document.getElementById("over").value;
		if (under.charAt(0) == '$') {under = under.slice(1)}
		if (over.charAt(0) == '$') {over = over.slice(1)}
		$("#slider-range").slider({
			range: true,
			min: 0,
			max: 100,
			values: [under, over],
			slide: function(event, ui) {
				$("#under").val('$' + ui.values[0]);
				$("#over").val('$' + ui.values[1]);
			}
		});
		$("#under").val('$' + $("#slider-range").slider("values", 0));
		$("#over").val('$' + $("#slider-range").slider("values", 1));
	});
	
	function updateSlider() {
		
		under = document.getElementById("under").value;
		over = document.getElementById("over").value;
		if (under.charAt(0) == '$') {under = under.slice(1)}
		if (over.charAt(0) == '$') {over = over.slice(1)}

		$("#slider-range").slider("values", 0, under);
		$("#slider-range").slider("values", 1, over);	
	}

</script>


<ul class="blue_bg engrave">
	<ul id="slider-range"></ul>
</ul>
<% form_for :consumer_rule, :url => { :action => :rules_update } do |f| %>

  	<ul class="thin_lines" style="margin-top:-10px">
    	<li >
    		<span class="item gray small_font" >Approve any purchase under</span>
			<span class="short_value">
				<%= f.text_field(:edited_auto_authorize_under, 
					:placeholder => "this amount",  
					:class => "value green",
					:id => "under",
					:onchange => "updateSlider()") %>
			</span>
		</li>
   	<li>
    		<span class="item gray small_font" >Unapprove any purchase over</span>
			<span class="short_value">
				<%= f.text_field(:edited_auto_deny_over, 
				:placeholder => "this amount",  
				:class => "value red",
				:id => "over",
				:onchange => "updateSlider()") %>
			</span>
		</li>
	</ul>

	

<ul class="banner_question_mark">
		<span style="position:absolute;left:12px;font-size:14px">If I do need to be involved, reach me by</span>
		<span><%= link_to "shal", "involved_help", :class => "slideup transparent question_mark" %> </span>
</ul>
	<%if @payer.phone_alert %>
		<a href="sms_prefs" class="contact"><img src="/images/iPhone SMS 64.png" border="0"></a> 
	<% else %>
		<a href="/aol/sms_prefs" class="contact"><img src="/images/iPhone SMS 64 bw.png" border="0"></a> 
	<% end %>
	<% if @payer.email_alert %>
		<a href="/aol/email_prefs" class="contact"><img src="/images/iPhone email 64.png" border="0"></a> 
	<% else %>
		<a href="/aol/email_prefs" class="contact"><img src="/images/iPhone email 64 bw.png" border="0"></a> 
	<% end %>
		<%= image_tag 'Skype 64 bw 1.png', :class => "contact" , :id => "skype" %>
		<%= image_tag 'aol aim bw.png', :class => "contact", :id => "aim"%>

  	<%= submit_tag "Submit", :class => "whiteButton submit bottom_submit_tag" %>
<% end %>

	</div>

	<div id="tabs-6">
		<p>Proin elit arcu, rutrum commodo, vehicula tempus, commodo a, risus. Curabitur nec arcu. Donec sollicitudin mi sit amet mauris. Nam elementum quam ullamcorper ante. Etiam aliquet massa et lorem. Mauris dapibus lacus auctor risus. Aenean tempor ullamcorper leo. Vivamus sed magna quis ligula eleifend adipiscing. Duis orci. Aliquam sodales tortor vitae ipsum. Aliquam nulla. Duis aliquam molestie erat. Ut et mauris vel pede varius sollicitudin. Sed ut dolor nec orci tincidunt interdum. Phasellus ipsum. Nunc tristique tempus lectus.</p>
	</div>
	<div id="tabs-7">
		<p>Proin elit arcu, rutrum commodo, vehicula tempus, commodo a, risus. Curabitur nec arcu. Donec sollicitudin mi sit amet mauris. Nam elementum quam ullamcorper ante. Etiam aliquet massa et lorem. Mauris dapibus lacus auctor risus. Aenean tempor ullamcorper leo. Vivamus sed magna quis ligula eleifend adipiscing. Duis orci. Aliquam sodales tortor vitae ipsum. Aliquam nulla. Duis aliquam molestie erat. Ut et mauris vel pede varius sollicitudin. Sed ut dolor nec orci tincidunt interdum. Phasellus ipsum. Nunc tristique tempus lectus.</p>
	</div>
	<div id="tabs-8">
		<p>Proin elit arcu, rutrum commodo, vehicula tempus, commodo a, risus. Curabitur nec arcu. Donec sollicitudin mi sit amet mauris. Nam elementum quam ullamcorper ante. Etiam aliquet massa et lorem. Mauris dapibus lacus auctor risus. Aenean tempor ullamcorper leo. Vivamus sed magna quis ligula eleifend adipiscing. Duis orci. Aliquam sodales tortor vitae ipsum. Aliquam nulla. Duis aliquam molestie erat. Ut et mauris vel pede varius sollicitudin. Sed ut dolor nec orci tincidunt interdum. Phasellus ipsum. Nunc tristique tempus lectus.</p>
	</div>
	
</div>

