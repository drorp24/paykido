<% title "Purchases" %>

<ul id="table"></ul>

	<script type="text/javascript">
	      google.load("visualization", "1", {packages:["table"]});
		  google.setOnLoadCallback(drawTable);

		  var table;
		  
		  function drawTable(){
			
		  var cssClassNames = {'tableCell': 'purchasesCell', 'oddTableRow' : 'purchasesOddRow'};
		  
		  var data = new google.visualization.DataTable();
		  	data.addColumn('string', 'Retailer');
		    data.addColumn('string', 'Product');
/*
			data.addColumn('string', 'Category');
*/
			data.addColumn('number', 'Amount');
			data.addColumn('string', 'Date');
			
		    <%= "data.addRows(#{@purchases.size});" %>
			<% @purchases.each do |p| -%>
		    	<%= "data.setCell(#{@i}, 0, '#{p.retailer.name}');" %>
				<%= "data.setCell(#{@i}, 1, '#{p.product.title}');" %>
			/*	<%= "data.setCell(#{@i}, 2, '#{p.product.category.name}');" %>    */
				<%= "data.setCell(#{@i}, 2,  #{p.amount}#{(p.id/10)}#{(p.id%10)});" %>
				<%= "data.setCell(#{@i}, 3, '#{p.date.to_s.last(5)}');" %>
				<% @i += 1 %>
			<% end %>

			var table = new google.visualization.Table(document.getElementById('table'));
			
			var formatter = new google.visualization.NumberFormat({prefix: '$' , fractionDigits: 2});
  			formatter.format(data, 2); // Apply formatter to third column
  			
			var formatter_short = new google.visualization.DateFormat({formatType: 'short'});
			formatter_short.format(data, 3);
			
			var formatter = new google.visualization.BarFormat({width: 50});
  			formatter.format(data, 2); // Apply formatter to third column


			table.draw(data, {'cssClassNames': cssClassNames, sortColumn: 2, sortAscending: false, allowHtml: true, alternatingRowStyle: true});
			
			google.visualization.events.addListener(table, 'select', selectHandler);			  	
		  }		
		  
		  	function selectHandler(){
			var selection = table.getSelection();
			var item = selection(2);
			purchase_amt = getValue(item.row, item.column);
			alert('You selected ');
	
		  }


    </script>
