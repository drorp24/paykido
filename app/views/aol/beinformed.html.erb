<% title "My Information" %>

<div id="info" style="margin-top:10px">
	<ul  style="height:15px;width:169px;margin:5px;margin-left:0;padding:3px;text-align:center;background-image:url('/images/heading_bg1.png');color:white;text-align:left;text-shadow: rgba(0,0,0,.2) 0 5px 3px;font-weight:100;font-size:14px;">Top Categories</ul>
	<div id="categoryChart">
		<div id="purchases_by_category"></div>
	</div>

	<div id="lists" >
		
		<div id="top_products" >
			<ul  id="beinformed_heading" style="height:22px;width:140px;margin:5px;margin-left:0;padding-left:5px;text-align:center;background-image:url('/images/heading_bg1.png');color:white;text-align:left;text-shadow: rgba(0,0,0,.2) 0 5px 3px;font-weight:100;font-size:14px">Top Products</ul>
			<ul class="rounded">
			<% Purchase.payer_top_products(@payer.id, 3).each do |product_id, total|%>
				<li>
					<%= link_to Product.find(product_id).title, "purchases_by_product/#{product_id}", :class => "short_item" %>
					<span class="short_value">
						<span class="right_indented"><%= number_to_currency(total) %></span>
					</span>
				</li>
			<% end %>
			</ul>
		</div>

		<div id="top_retailers">
			<ul  id="beinformed_heading" style="height:22px;width:140px;margin:5px;margin-left:0;padding-left:5px;text-align:center;background-image:url('/images/heading_bg1.png');color:white;text-align:left;text-shadow: rgba(0,0,0,.2) 0 5px 3px;font-weight:100;font-size:14px;">Top Merchants</ul>
			<ul class="rounded framed">
			<% Purchase.payer_top_retailers(@payer.id, 3).each do |retailer_id, total|%>
				<li>
					<%= link_to Retailer.find(retailer_id).name, "purchases_by_retailer/#{retailer_id}", :class => "short_item" %>
					<span class="short_value">
						<span class="right_indented"><%= number_to_currency(total) %></span>
					</span>
				</li>
			<% end %>
			</ul>
		</div>
		
	</div>	
</div>
<ul class="rounded wide">
	<li class="arrow"><%= link_to "Review all purchases", "purchases_all" %></li>
</ul>	
    <script type="text/javascript">
      google.load("visualization", "1", {packages:["piechart"]});
      google.setOnLoadCallback(drawChart);
      function drawChart() {
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Category');
        data.addColumn('number', 'Total');
        data.addRows(<%= @categories.size %>);
		<% @categories.each do |category_id, amount| -%>
			data.setValue(<%= @i %>, 0, '<%= Category.find(category_id).name %>');
			data.setValue(<%= @i %>, 1, <%= amount %>);
			<% @i += 1 %>
		<% end %>
 
        var chart = new google.visualization.PieChart(document.getElementById('purchases_by_category'));
        chart.draw(data, 
				   {width: 172,
				    height: 230, 
					title: 'Purchases by Category', 
					titleFontSize: 13, 
					backgroundColor: '#ccebd2', 
					legend: 'bottom', 
					is3D: true, 
					title: 'My Daily Activities',
					colors: [{color:'orange', darker:'#680000'}, {color:'#1B7BDD', darker:'black'},{color:'#666666', darker:'black'}, {color:'#dc3912', darker:'black'}]
      });
	  }
    </script>
	