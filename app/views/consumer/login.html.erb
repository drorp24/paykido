<div id="window_content">

	<div id="logo">
		<%= image_tag "/images/arca_logo.png", :id=>"logoimg",:border => 0 %>
	</div>	
		
	<div id="welcome_message" class="text">
		<div id="welcomeline" class="text">
			<span id="salutation"><%= @salutation %></span>
			<span id="name"><%= @name %></span>
		</div>
		<div id="login_button" class="text">
			<fb:login-button perms="offline_access" 
							 registration-url="#registration"
							 onlogin="$.ajax({url: 'http://www.paykido.com/consumer/login_callback'});"
							 autologoutlink="true"
							 V="2" />
		</div>
 	</div>

   	<div id="ajax_message">
		<p id="first_line" class="text"><%= @first_line %><span id="action"></span></p>
		<p id="second_line" class="text"><%= @second_line %></p>		
	</div>
	
	<div id="buy" class="box">
		<% form_for :consumer, :url => {:action => :buy}, :html => {:id => "buy_form"} do |f| %>
			<%= submit_tag "1-click to buy", :id=> "buy_button", :class => "fg-button ui-state-default loginbutton ui-corner-all" %>
		<% end %>
	</div>
		
	<div id="pic-n-like">
	<div id="pic">
		<% if @pic %>
			<%= image_tag @pic %>
		<% end %>
	</div>
	<div id="like" class="box">
		<fb:like href="www.paykido.com" show_faces="true" width="300" font=""></fb:like>
	</div>
	</div>

</div>
		
<div id="registration" style="display: none;">
	<fb:registration  fb_only="true" width="600" redirect-uri="http://<%= request.host + ':' + request.port.to_s %>/consumer/register_callback"  fields='[
		{"name":"name"},
		{"name":"email"},
		{"name":"password",   "view":"not_prefilled"},
		{"name":"birthday"},
		{"name":"consumer_phone",    "description":"My mobile phone number",  	"type":"text"},
		{"name":"message",    "description":"Message To My Parent",  	"type":"text"},
		{"name":"payer_name",      "description":"My Parent Name",             "type":"text"},
		{"name":"payer_phone",      "description":"My Parent Mobile Phone",             "type":"text"},
		{"name":"payer_email",      "description":"My Parent Email Address",             "type":"text"}
	]' onvalidate="validate"></fb:registration>

<script> 
function validate(form) {

  errors = {};
  
    var illegalPhone = /[-+\(\)0-9]+/;
  	var reg = /^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;
	 	
	function IsNumeric(input)
	{
	    return (input - 0) == input && input.length > 0;
	}
	
  	if (form.payer_name == "") {
    	errors.payer_name = "Please enter parent name";
  	}

  	if (form.message == "") {
    	errors.message= "Please enter message";
  	}

	if (form.payer_phone == "") {
        errors.payer_phone = "Please enter phone number";
    } else if (form.payer_phone.length !== 10) {
        errors.payer_phone= "Valid phone number please!";
    } else if (!IsNumeric(form.payer_phone)) {
        errors.payer_phone= "Only digits please!";
    }
	
	if (form.consumer_phone == "") {
        errors.consumer_phone = "Please enter phone number";
    } else if (form.consumer_phone.length !== 10) {
        errors.consumer_phone= "Valid phone number please!";
    } else if (!IsNumeric(form.consumer_phone)) {
        errors.consumer_phone= "Only digits please!";
    }

	 if(reg.test(form.payer_email) == false) {
        errors.payer_email = "Valid email address please!";
    }


  return errors;
}
</script> 
</div>
<script type="text/javascript">

	<% unless @consumer %>
		$('#buy_button').addClass("ui-state-hover").blur();
	<% end %>

$(document).ready(function (){ 

	var sms_param = $.url.param("sms");
	if (sms_param == "failed") {
		FB.api({ method: 'Auth.revokeAuthorization' }, 
        	function(response) {

                              });
	}		

	var url_product_param = $.url.param("product");
	if (url_product_param) {
		var product_param = 'product=' + url_product_param; 
	}
	else {
		var product_param = $('form').serialize();
	}
	$.ajax({url: '/consumer/save_state?scroll=' + $(document).scrollTop() + '&' + product_param});

	$('#login_button').click(function() {
		if ($('.fb_button_text').html() == 'Register') {
			$('#registration').attr('style', 'display:block');			
		}
	})
	
});

</script>