<% if params[:name] and params[:invited_by] %>
	<p class="invitation_msg" id="second"><%= "Hi #{params[:name]}" %>
	<p class="invitation_msg" id="third"><%= "#{params[:invited_by]} wants you to know Paykido" %></p>
	<%= button_to "Tell me more", {:controller => :service, :action => :registration}, :class => "fg-button ui-state-default loginbutton ui-very-rounded-corners", :id => "tell_me_more" %>
<% end %>
<div id="payer_tabs">
	<ul class = "ui-tabs-nav">
		<li><a href="#consumers"><%= t 'Consumers' %></a></li>
		<li><a href="#retailers"><%= t 'Retailers' %></a></li>
		<li><a href="#products"><%= t 'Products' %></a></li>
		<li><a href="#categories"><%= t 'Categories' %></a></li>
		<li><a href="#purchases"><%= t 'Purchases' %></a></li>
		<li><a href="#preferences"><%= t 'Settings' %></a></li>
	</ul>
	<div id="consumers">
		<div id="consumers_tabs">
			<ul class = "ui-tabs-nav" id="no_tabs_background1">
				<li><a href="#allowance" id ="allowance_tab">Allowance</a></li>
				<li><a href="#thresholds" id ="thresholds_tab">Thresholds</a></li>
				<li><a href="#info" id ="info_tab">Info</a></li>
			</ul>
			<div id="allowance" class="consumers_page">
				<div class="left_content">
					<p class="content-name-left" id="consumer_name_allowance"></p>		
					<div id="gauge"><img id='chartdiv' class="engrave"/></div>
					<%= form_for :consumer, :url => {:action => :consumer_update }, :html => {:id => "allowance_form"} do |f| %>			
					    <div class="long item" id="budget_slider" onclick="modifyBudget('post')"></div>
						<p>
							<span id="allowance_period"><%= f.select(:allowance_period, Consumer.human_attribute_name("allowance_period"),{}, :onchange => "$('#allowance_form').submit();" )%></span>
						    <span class="long item"><%= t :allowance %></span>
							<span class="allowance_value"><%= f.text_field(:allowance, :onchange => "modifyBudget('post')", :id => "budget", :size => 10) %></span>							
						</p>
						<p>							
						    <span id="balance_title" class="long item"><%= t :current_balance %></span>
							<span id="balance" class="balance_value"></span>
						</p>
						<p>
							<span class="long item">On </span>
							<span id="next_allowance"></span>
							<span class="long item"> add </span>
							<span id="budget1" class="long item""></span>
						</p>	
					<% end %>
				</div>
				<div class="middle_content">
				</div>
				<div class="right_content consumers_list">
					<p class="inner_content_title" id="consumers">&nbsp;</p>
					<%= form_for :payer, :url => { :action => :payer_update }, :html => {:id => "community_form"}  do |f| %>
						<p class="content-name-right" id="family_name"><%= f.text_field :name, :onchange => "renameCommunity($(this).val())" %></p>
					<% end %>		
					<%= form_for :consumers, :url => { :action => :consumer_update }, :html => {:id => "consumer_form"}  do |f| %>
					<div class="consumer column1 sortable ui-sortable" ></div>
					<div class="consumer column2 sortable ui-sortable" ></div>
					<% end %>
				</div>
			</div>
			<div id="thresholds" class="consumers_page">
				<div class="left_content">
					<p class="content-name-left" id="consumer_name_approvals"></p>
					<div class="inner_content_text">&nbsp;</div>
					<div class="inner_content_text"><span>Should Paykido automatically approve</span><span id="cname"></span><span>'s low</span></div>
					<div class="inner_content_text">priced purchases , or deny high priced ones?</div>
					<div id='slider-range' class="engrave" onclick="modifyUnderOver('post')"></div><br />
					<%= form_for :consumer, :url => { :action => :consumer_update }, :html => {:id => "amounts_form"} do |f| %>
						<p id="slider">
							<span class="rule">Approve anything under</span>
							<span><%= f.text_field(:auto_authorize_under, :onchange => "modifyUnderOver('post')", :id => "under", :size => 10) %></span>
						</p>
						<p>
						    <span class="rule">Deny anything over</span>
							<span><%= f.text_field(:auto_deny_over, :onchange => "modifyUnderOver('post')", :id => "over",  :size => 10) %></span>					
						</p>
					<% end %>
				</div>
				<div class="middle_content">
				</div>
				<div class="right_content consumers_list">
					<p class="inner_content_title" id="consumers">&nbsp;</p>
					<%= form_for :payer, :url => { :action => :payer_update }, :html => {:id => "community_form"}  do |f| %>
						<p class="content-name-right" id="family_name"><%= f.text_field :name, :onchange => "renameCommunity($(this).val())" %></p>
					<% end %>		
					<%= form_for :consumers, :url => { :action => :consumer_update }, :html => {:id => "consumer_form"}  do |f| %>
					<div class="consumer column1 sortable ui-sortable" ></div>
					<div class="consumer column2 sortable ui-sortable" ></div>
					<% end %>
				</div>
			</div>
			<div id="info" class="consumers_page">
				<div class="left_content">
					<p class="content-name-left" id="consumer_info"></p><br />
					<%= form_for(:consumer, :url => {:action => :consumer_update}, :html => {:id => "consumer_info_form"}) do |f| %>			
						<p>
							<span class=item>Name:</span>			
							<span class=content-value id="consumer_info_name"><%= f.text_field(:name, :size => 25, :onchange => "consumer_rename_no_ajax($(this).val());$('#consumer_info_form').submit();") %></span> 
						</p>
						<p>
							<span class=item>Phone:</span>			
							<span class=content-value id="consumer_info_phone"><%= f.text_field :billing_phone, :size => 25, :onchange => "$('#consumer_info_form').submit();" %></span> 
						</p>
					<% end %>
				</div>				
				<div class="middle_content">
				</div>
				<div class="right_content consumers_list">
					<p class="inner_content_title" id="consumers">&nbsp;</p>
					<%= form_for :payer, :url => { :action => :payer_update }, :html => {:id => "community_form"}  do |f| %>
						<p class="content-name-right" id="family_name"><%= f.text_field :name, :onchange => "renameCommunity($(this).val())" %></p>
					<% end %>		
					<%= form_for :consumers, :url => { :action => :consumer_update }, :html => {:id => "consumer_form"}  do |f| %>
					<div class="consumer column1 sortable ui-sortable" ></div>
					<div class="consumer column2 sortable ui-sortable" ></div>
					<% end %>					
				</div>
			</div>
		</div>
	</div>

	<div id="retailers">
		<div class="left_content"></div>
		<div class="right_content retailers_list"></div>
	</div>

	<div id="products">
		<div class="left_content"></div>
		<div class="right_content products_list"></div>
	</div>

	<div id="categories">
		<div class="left_content"></div>
		<div class="right_content categories_list"></div>
	</div>

	<div id="purchases">
	</div>

	<div id="preferences">
		<div id="preferences_tabs">
			<ul class = "ui-tabs-nav" id="no_tabs_background">
				<li><a href="#billing" id ="billing_tab">Billing</a></li>
				<li><a href="#alerts" id="alerts_tab">Notifications</a></li>
				<li><a href="#account" id ="account_tab">Account</a></li>
			</ul>
			<div id="billing">
				<br />
				<h3>Authorize the service</h3>
				<%= form_for :payer, :url => {:controller => :subscriber, :action => :payer_update} do |f| %>
					<p><%= f.radio_button "registered", false  %> Do not currently activate Paykido</p>			
					<p><%= f.radio_button "registered", true  %> Have Paykido check purchases and pay for them</p>			
					<p id = "charging"><%= f.check_box "facebook" %> I agree to let Paykido pay the merchant and charge me when purchase is approved</p>			
					<p><%= f.submit "I agree"%></p>
				<% end %>
			</div>
			<div id="alerts">
				<div class="left_content">
					<p class="content-name-right" id="alerts_pane">Alerts</p>
					<%= form_for :payer, :url => { :action => :payer_update }, :html => {:id => "phone_alert_form"} do |f| %>
						<div id="phone_alert_shade_area">
							<div class="inner_content_subtitle" id="extra_space2">Notify me</div>
							<div class="form_line">
								<span class="icon">
									<%= image_tag("/images/iPhone Dial.png", :id => "dial", :class => "communication", :border => "0")%>
								</span>
								<span class ="item_by_icon">
									<%= f.select(:phone_events, Payer.phone_events,{}, :onchange => "$('#phone_alert_form').submit();", :class => "value borderless" )%>
								</span>
							</div>
							<div class="form_line">
								<span class="icon">
									<%= image_tag("/images/iPhone Clock.png", :id => "clock", :class => "communication", :border => "0")%>
								</span>
								<span class ="item_by_icon">
									<%= f.select(:phone_alert_frequency, Payer.phone_alert_frequency,{}, :onchange => "$('#phone_alert_form').submit();", :class => "value borderless" )%>
								</span>
							</div><br />
							<div class="inner_content_subtitle" id="extra_space2">On</div>
							<div class="form_line">
								<span class="icon">
									<%= image_tag("/images/iPhone SMS 64.png", :id => "sms", :class => "communication", :border => "0")%>
								</span>
								<span class ="item_by_icon">
									<%= f.text_field(:edited_phone, :onchange => "$('#phone_alert_form').submit();", :class => "value borderless", :placeholder => "which phone to text?"  )%>
								</span>
							</div>
						</div>
						<div class="form_line">
							<span id="phone_alert" class="buttonset">
								<%= f.radio_button("phone_alert_human", "On", :onchange => "viewPhoneAlert('toggle');$('#phone_alert_form').submit();") %><label for="payer_phone_alert_human_on">On</label>
								<%= f.radio_button("phone_alert_human", "Off",:onchange => "viewPhoneAlert('toggle');$('#phone_alert_form').submit();") %><label for="payer_phone_alert_human_off">Off</label>
							</span>
						</div>
					<% end %>
				</div>
				<div class="right_content">
					<p class="content-name-right" id="reports_pane">Reports</p>
					<%= form_for :payer, :url => { :action => :payer_update }, :html => {:id => "email_alert_form"} do |f| %>
						<div id="email_alert_shade_area">
							<div class="inner_content_subtitle" id="extra_space3">Inform about</div>
							<div class="form_line">
								<span class="icon">
									<%= image_tag("/images/iPhone Notes.png", :id => "report", :class => "communication", :border => "0")%>
								</span>
								<span class ="item_by_icon">
									<%= f.select(:email_events, Payer.email_events,{}, :onchange => "$('#email_alert_form').submit();", :class => "value borderless" )%>
								</span>
							</div>
							<div class="form_line">
								<span class="icon">
									<%= image_tag("/images/iPhone Clock.png", :id => "clock", :class => "communication", :border => "0")%>
								</span>
								<span class ="item_by_icon">
									<%= f.select(:email_alert_frequency, Payer.email_alert_frequency,{}, :onchange => "$('#email_alert_form').submit();", :class => "value borderless" )%>
								</span>
							</div><br />
							<div class="inner_content_subtitle" id="extra_space2">On</div>
							<div class="form_line">
								<span class="icon">
									<%= image_tag("/images/iPhone eMail 64.png", :id => "email", :class => "communication", :border => "0")%>
								</span>
								<span class ="item_by_icon">
									<%= f.text_field(:email, :onchange => "$('#email_alert_form').submit();", :class => "value borderless"  )%>
								</span>
							</div>
						</div>
						<div class="form_line">
							<span id="email_alert" class="buttonset">
								<%= f.radio_button("email_alert_human", "On", :onchange => "viewEmailAlert('toggle');$('#email_alert_form').submit();") %><label for="payer_email_alert_human_on">On</label>
								<%= f.radio_button("email_alert_human", "Off",:onchange => "viewEmailAlert('toggle');$('#email_alert_form').submit();") %><label for="payer_email_alert_human_off">Off</label>
							</span>
						</div>
					<% end %>
				</div>
			</div>
			<div id="account">
			</div>
		</div>
	</div>
	
</div>

<script type="text/javascript">


		viewConsumers  ();
		viewRetailers  ();
		viewProducts   ();
		viewCategories ();	
		viewPurchases();
		viewPhoneAlert (<%= @payer.phone_alert %>);	
		viewEmailAlert (<%= @payer.email_alert %>);


	function viewConsumers() {
		$.ajax({
			url: 'consumers',
			success: function(data){
			}
		})
	};


	function viewRetailers(){
		$.ajax({
			url: 'retailers',
			success: function(data){
			}
		})
	};


	function viewProducts(){
		$.ajax({
			url: 'products',
			success: function(data){
			}
		})
	};

	function viewCategories(){
		$.ajax({
			url: 'categories',
			success: function(data){
			}
		})
	};
	
	function viewPurchases(){
			$.ajax({
					url: 'purchases',
					success: function(data){
					}
			})				
	};

	function viewPhoneAlert(phone_alert){

		$('#phone_alert_notice').remove(); 
		$('#payer_edited_phone').val("<%= @payer.edited_phone %>");

		if (phone_alert == "toggle") {
			$('#phone_alert_shade_area').toggleClass("shaded");
		} 
		else {
			if (phone_alert) {
				$('#phone_alert_shade_area').removeClass("shaded");
			}
			else
			{
				$('#phone_alert_shade_area').addClass("shaded");
			}
		}
	};
	
	function viewEmailAlert(email_alert){

		$('#email_alert_notice').remove(); 

		if (email_alert == "toggle") {
			$('#email_alert_shade_area').toggleClass("shaded");
		} 
		else {
			if (email_alert) {
				$('#email_alert_shade_area').removeClass("shaded");
			}
			else
			{
				$('#email_alert_shade_area').addClass("shaded");
			}
		}
	};
		
	function modifyBudget (verb, budget, balance) {

		$(function () {
			$("#budget_slider").slider({
				value: budget,
				min: 0,
				max: 150,
				slide: function(event, ui) {
					$("#budget").val(ui.value +'.00');
				}
				
			});

		});

		$(function () {
			$("#budget_slider").slider({
				change: function(event, ui){
			
				}

			});
		});

		if (verb == "post") {
			$('#allowance_form').submit();
		}

	}	

	
	
	function drawChart(allowance, balance){

	<% if Current.policy.online? %>
		var balance_position = (balance / allowance) * 100;	
		var tick = ((allowance / 40).toFixed(1)) * 10;
		var background = "chf=c,lg,90,FFE7C6,0,76A4FB,0.5"
		var uri = "http://chart.apis.google.com/chart?cht=gom&chs=300x110&chf=bg,lg,90,FFFEE0,0,FFFFF5,0.75&chxt=y&chd=t:" + balance_position + "&chl=Balance&chxr=0,0," + allowance + "," + tick;
	<% else %>
		var uri = "/images/google_visualization_fake_service.png";	
	<% end %>
		document.getElementById("chartdiv").src = uri;

	}

	
	function convertToCurrency(){
		document.getElementById("budget").value = '$' + document.getElementById("budget").value;
		document.getElementById("balance").value = '$' + document.getElementById("balance").value;
	}
		
	function modifyUnderOver(verb, under, over) {
		
		$(function () {
			
			$("#slider-range").slider({
				range: true,
				min: 0,
				max: 100,
				values: [under, over],
				slide: function(event, ui) {
					$("#under").val(ui.values[0] + '.00');
					$("#over").val(ui.values[1] + '.00');
					$("#under1").html(ui.values[0] + '.00 ');
					$("#over1").html(ui.values[1] + '.00 ');
				}
			});
	
			});

		if (verb == "post") {
			$('#amounts_form').submit();
		}

	};


	
	



</script>